version: '3'
services:
  envoy-users-v2:
    build:
        context: .
        dockerfile: Dockerfile-envoy
    command: ["envoy", "-c", "/etc/envoy/sidecar.yaml", "-l", "trace"]
    ports:
      - "80:9000"   # expose ingress
      - "9901:9901" # expose admin

  users-v2:
    build: .
    command: ["users-v2", "-w", "envoy-users-v2:9100"] # sidecar egress

  widgets-v1:
    build: .
    command: ["widgets-v1"]
