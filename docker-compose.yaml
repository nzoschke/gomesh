version: '3'
services:
  users-v2:
    build: .
    command: ["users-v2", "-w", "widgets-v1:8000"]
    ports:
     - "8000"

  users-v2-envoy:
    build:
        context: .
        dockerfile: Dockerfile-envoy
    command: ["envoy", "-c", "/etc/envoy/sts.yaml"]
    ports:
      - "80:10000"
      - "9901:9901"

  widgets-v1:
    build: .
    command: ["widgets-v1"]
    ports:
     - "8000"
